[:page partOf="trails" args="lightTraceRenderers"]

    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACqUcoVGLVERGKxv09yqg9jv1iykUDJjA&sensor=false">
    </script>
    <script type="text/javascript">

      var map = null ;
      var markers = {};
      
      function addMarker(targetMap,  key,  title, lat, long ){
        if(key in markers){
          markers[key].setMap(map) ;
        }else{
          markers[key] = new google.maps.Marker({
            position:   new google.maps.LatLng(lat,long),
            map: targetMap,
            title: title
          });
        }
      }

      function addMarkerToMap( key,  title, lat, long ){
        addMarker(map,  key,  title, lat, long ) ;
      }      
      
      function removeMarker(key){
        if(key in markers){
          markers[key].setMap(null) ;
        }
      }

      function removeAllMarkers(){
        for (var key in markers) {
          markers[key].setMap(null);
        }
      }

      function fitMapViewPortWithMarkers(){
        
        var bounds = new google.maps.LatLngBounds ();
        for (var key in markers) {
          marker = markers[key];
          if (  marker.getMap() != null ){
            bounds.extend (marker.getPosition());
          }
        }        
        map.fitBounds (bounds);
        if (map.getZoom() > 12){
          map.setZoom(12);
        }
      }
      
      function initialize() {

        var baryCenter = new google.maps.LatLng([=lightTraceRenderers.baryCenter.latitude],
                                                 [=lightTraceRenderers.baryCenter.longitude]);
        
        var mapOptions = { zoom : 9,
                           mapTypeControl: false,
                           zoomControl: false,
                           center : baryCenter
        					};
        
        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        
        [:for lightTraceRenderer in lightTraceRenderers.traces]
        addMarker(map,
                  "[=lightTraceRenderer.keyJsSafe]", 
                  "[=lightTraceRenderer.titleJsSafe]",
                  [=lightTraceRenderer.trace.startPointLatitude],
                  [=lightTraceRenderer.trace.startPointLongitude] ) ;
        [/for]
      
        fitMapViewPortWithMarkers();
      }
      
      google.maps.event.addDomListener(window, 'load', initialize);
      
    </script>
    <div id="map-canvas"  class="space" ></div>

    

