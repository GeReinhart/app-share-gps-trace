//Auto-generated by RSP Compiler
//Source: searchResultsOnMap.rsp.html
part of trails;

/** Template, searchResultsOnMap, for rendering the view. */
Future searchResultsOnMap(HttpConnect connect, {lightTraceRenderers}) { //#2
  var _t0_, _cs_ = new List<HttpConnect>();
  HttpRequest request = connect.request;
  HttpResponse response = connect.response;
  if (!Rsp.init(connect, "text/html; charset=utf-8"))
    return new Future.value();

  response.write("""

    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACqUcoVGLVERGKxv09yqg9jv1iykUDJjA&sensor=false">
    </script>
    <script type="text/javascript">

      var map = null ;
      var markers = {};
      
      function addMarker(targetMap,  key,  title, lat, long ){
        if(key in markers){
          markers[key].setMap(map) ;
        }else{
          markers[key] = new google.maps.Marker({
            position:   new google.maps.LatLng(lat,long),
            map: targetMap,
            title: title
          });
        }
      }

      function addMarkerToMap( key,  title, lat, long ){
        addMarker(map,  key,  title, lat, long ) ;
      }      
      
      function removeMarker(key){
        if(key in markers){
          markers[key].setMap(null) ;
        }
      }

      function removeAllMarkers(){
        for (var key in markers) {
          markers[key].setMap(null);
        }
      }

      function fitMapViewPortWithMarkers(){
        
        var bounds = new google.maps.LatLngBounds ();
        for (var key in markers) {
          marker = markers[key];
          if (  marker.getMap() != null ){
            bounds.extend (marker.getPosition());
          }
        }        
        map.fitBounds (bounds);
        if (map.getZoom() > 12){
          map.setZoom(12);
        }
      }
      
      function initialize() {

        var baryCenter = new google.maps.LatLng("""); //#2

  response.write(Rsp.nnx(lightTraceRenderers.baryCenter.latitude)); //#56


  response.write(""",
                                                 """); //#56

  response.write(Rsp.nnx(lightTraceRenderers.baryCenter.longitude)); //#57


  response.write(""");
        
        var mapOptions = { zoom : 9,
                           mapTypeControl: false,
                           zoomControl: false,
                           center : baryCenter
        					};
        
        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        
"""); //#57

  for (var lightTraceRenderer in lightTraceRenderers.traces) { //for#67

    response.write("""        addMarker(map,
                  \""""); //#68

    response.write(Rsp.nnx(lightTraceRenderer.keyJsSafe)); //#69


    response.write("""", 
                  \""""); //#69

    response.write(Rsp.nnx(lightTraceRenderer.titleJsSafe)); //#70


    response.write("""",
                  """); //#70

    response.write(Rsp.nnx(lightTraceRenderer.trace.startPointLatitude)); //#71


    response.write(""",
                  """); //#71

    response.write(Rsp.nnx(lightTraceRenderer.trace.startPointLongitude)); //#72


    response.write(""" ) ;
"""); //#72
  } //for

  response.write("""      
        fitMapViewPortWithMarkers();
      }
      
      google.maps.event.addDomListener(window, 'load', initialize);
      
    </script>
    <div id="map-canvas"  class="space" ></div>

    

"""); //#74

  return new Future.value();
}
